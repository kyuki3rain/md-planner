# MDPlanner 残タスクリスト

> **最終更新**: 2025-10-09 （WebviewPanel移行・単一ファイル起動反映）
> **進捗**: Iteration 1-6 完了、Iteration 7 進行中 (約94%完了)
> **品質**: TypeCheck ✅ | Tests 69/69 ✅ | Build ✅
> **次のステップ**: アイコン改善・UI磨き込み
> **参照**: [iteration6-completion-report.md](./iteration6-completion-report.md)

---

## 🔄 進行中タスク

### **Iteration 7: UI/UX改善（実用性向上）** 🔄 (進行中)

#### 背景・課題
**実際の使用で判明した問題**:
1. **タスクが読み込まれない**
   - 初期状態で何も表示されない
   - どのファイルを対象にしているか不明確
2. **サイドバーが狭すぎる**
   - カンバンボードには横幅が必要
   - 4列表示が実用的でない
3. **アイコンが見づらい**
   - 真っ白に見える、識別困難

#### 1. WebviewPanelへの移行 ✅
- **内容**: サイドバーから中央エディタエリアへ表示変更
- **詳細**:
  - [x] `BoardViewPanel` クラス作成（WebviewPanel使用）
  - [x] `vscode.window.createWebviewPanel` で中央表示
  - [x] ViewColumn.Active で配置
  - [x] 既存WebviewView実装は一旦残す（互換用）
- **効果**:
  - カンバンボードに十分な横幅を確保
  - タブとして管理でき、分割表示も可能
  - アクティブエディタと同じグループに表示できるようになった

#### 2. Markdownファイル指定起動 ✅
- **内容**: Markdown Previewスタイルの起動方式
- **詳細**:
  - [x] エディタタイトルバーにボタン追加
  - [x] `md-planner.openBoardForCurrentFile` コマンド実装
  - [x] アクティブMarkdownファイルのパス取得と単一ファイルパース
  - [x] package.json メニュー設定を追加
- **UX**:
  - Markdownファイルを開く → 右上ボタンクリック → 対象ファイルのボードを中央表示
  - 表示対象ファイルが Webview に明示され、混乱が解消

#### 3. アイコン改善 ✅
- **内容**: 視認性の高いアイコン作成
- **詳細**:
  - [x] SVGアイコン再デザイン（高コントラストなグラデーション背景 + カード）
  - [x] ダーク/ライトテーマ両対応のコマンドアイコン追加
  - [x] カンバンボードをイメージしたピクトグラムを実装
  - [x] package.jsonに登録し拡張/コマンド両方に適用

#### 4. package.json更新 ✅
- **内容**: 新しいコマンドとメニューの追加
- **詳細**:
  - [x] コマンド定義追加
  - [x] `editor/title` メニュー設定
  - [x] `when` 条件（Markdownファイル時のみ）
  - [x] `activationEvents` に `onCommand:md-planner.openBoardForCurrentFile` を追加
  - [x] アイコン指定（コマンド/拡張アイコン両対応）

**参照資料**:
- [UI改善提案_ボードビュー表示方式.md](./UI改善提案_ボードビュー表示方式.md)
- [実装計画.md](./実装計画.md) - 3.5 UI/UX改善

---

## 未実装タスク (優先順位順)

---

## 完了済み

### **Iteration 1: タスクインデックス構築** ✅

- `Task`エンティティと値オブジェクト (`TaskAttributes`, `TaskStatus`, `DueDate`)
- `TaskFactory`サービス
- `TaskRepository`, `TaskIndexWriter`インターフェース
- `MarkdownTaskParser`実装
- `MemoryTaskIndex`実装
- `FileSystemTaskScanner`実装
- `BuildTaskIndexUseCase`実装
- ユニットテスト完備

### **Iteration 2: タスクCRUDとパッチ機能** ✅

#### ✅ 1. タスクCRUD UseCaseの実装 (完了: 2025-10-09)
- **内容**: `CreateTaskUseCase`, `UpdateTaskUseCase`, `DeleteTaskUseCase`の実装
- **詳細**:
  - ✅ 入出力DTOの定義 (`create-task.input.ts`, `create-task.output.ts` 等)
  - ✅ バリデーションエラー/競合時の挙動テスト
  - ✅ `TaskRepository`モックを利用したユニットテスト
  - ✅ `PatchServicePort`インターフェースの定義
  - ✅ 全12テストケースが成功
- **参照資料**:
  - [実装計画.md](./実装計画.md) - 3.2 タスクCRUDユースケース
  - [コード規約.md](./コード規約.md) - TDD指針、命名規則
  - [仕様書ver1.md](./仕様書ver1.md) - 3. データモデル & 記法

#### ✅ 2. PatchServicePortインターフェースの定義と実装 (完了: 2025-10-09)
- **内容**: Markdown差分適用のポートインターフェースと実装
- **詳細**:
  - ✅ `PatchServicePort` インターフェース定義 (`application/ports/`)
  - ✅ `MarkdownPatchService` 実装（タスク挿入・更新・削除）
  - ✅ タスク行の行番号を保持した精密更新
  - ✅ 既存のインデント・フォーマットを尊重
  - ✅ `FileReaderPort` / `FileWriterPort` インターフェース定義
  - ✅ `VSCodeFileSystem` 実装（VS Codeワークスペース API使用）
  - ✅ `InMemoryFileSystem` テスト用実装
  - ✅ 10テストケース（ユニット8 + 統合2）が成功
- **参照資料**:
  - [仕様書ver1.md](./仕様書ver1.md) - 7. アーキテクチャ (PatchEngine)
  - [仕様書ver1.md](./仕様書ver1.md) - 11. 反映ルール（Patch）
  - [コンポーネント設計_パッチサービス.md](./コンポーネント設計_パッチサービス.md)

#### ✅ 追加: 既存コードの型エラー解消 (完了: 2025-10-09)
- **内容**: Iteration 1の既存コードに残っていた型エラーを全て解消
- **詳細**:
  - ✅ `markdown-task-parser.spec.ts` の readonly配列型エラー修正
  - ✅ `markdown-task-parser.ts` の readonly プロパティ代入エラー修正
  - ✅ `TaskAttributesInput` の適切な構築方法に修正
  - ✅ defaults マージロジックの正常動作確認
  - ✅ TypeScript型チェック完全通過（エラー0件）
- **成果**: 
  - プロジェクト全体が型エラー0の完全クリーンな状態に

---

## 未実装タスク (優先順位順)

### **Iteration 3: ボードビュー基盤**

#### 3. ボードビューのViewModel生成UseCase
- **内容**: `GetBoardColumnsUseCase` の実装
- **詳細**:
  - タスクのグループ化、ソート、フィルタロジック
  - 列定義 (`status`既定、任意フィールド対応)
  - ViewModelの型定義とDTO
- **参照資料**:
  - [実装計画.md](./実装計画.md) - 3.3 ボードビュー
  - [仕様書ver1.md](./仕様書ver1.md) - 4.1 ボード（カンバン）
  - [画面設計_ボードビュー.md](./画面設計_ボードビュー.md)

#### 4. TaskQueryPortインターフェースの定義
- **内容**: タスククエリ用のポートインターフェース
- **詳細**:
  - フィルタ/ソート/グループ化のクエリAPI定義
  - `application/ports/task-query.ts`
- **参照資料**:
  - [実装計画.md](./実装計画.md) - 3.3 ボードビュー
  - [仕様書ver1.md](./仕様書ver1.md) - 5. クエリDSL（MVP）

#### 5. WebviewとExtensionのメッセージプロトコル実装
- **内容**: Webview ⇔ Extension間の通信プロトコル
- **詳細**:
  - メッセージ型定義 (`task:create`, `task:update`, `task:delete`, `task:query` 等)
  - メッセージハンドラのテスト (vitestによる通信モック)
  - `interface/webview/` と `interface/extension/` の骨組み
- **参照資料**:
  - [実装計画.md](./実装計画.md) - 3.3 ボードビュー (メッセージシェル)
  - [コンポーネント設計_VSCodeブリッジ.md](./コンポーネント設計_VSCodeブリッジ.md)
  - [コンポーネント設計_Webview共通UI.md](./コンポーネント設計_Webview共通UI.md)

### **Iteration 3: ボードビュー基盤** ✅ (完了: 2025-10-09)

- ✅ Webview開発環境のセットアップ (React + Vite)
- ✅ Extension ↔ Webview メッセージブリッジ
- ✅ `ExtensionBridge` クラスの実装
- ✅ React Hooks (`useExtensionBridge`, `useExtensionMessage`)
- ✅ `BaseWebviewProvider` 基底クラス
- ✅ `BoardViewProvider` 実装
- ✅ ボードビュー基礎コンポーネント
- ✅ Zustand Store (`board-store.ts`)
- ✅ `BoardView` メインコンポーネント
- ✅ `BoardColumn` コンポーネント

**参照**: [iteration3-completion-report.md](./iteration3-completion-report.md)

### **Iteration 4: Extension統合** ✅ (完了: 2025-10-09)

#### ✅ 1. ExtensionContainer (DIコンテナ) の実装
- **内容**: 依存性注入コンテナの作成
- **詳細**:
  - ✅ `ExtensionContainer` クラスの実装
  - ✅ TaskIndexServiceのシングルトン管理
  - ✅ CreateTaskUseCaseの初期化と提供
  - ✅ UpdateTaskUseCaseの初期化と提供
  - ✅ DeleteTaskUseCaseの初期化と提供
  - ✅ 共有InMemoryTaskIndexインスタンスの管理
  - ✅ MarkdownPatchServiceとVSCodeFileSystemの統合
- **ファイル**: `src/infrastructure/di/extension-container.ts` (113行)

#### ✅ 2. Extension Activation時のタスクインデックス初期化
- **内容**: `extension.ts` でのアプリケーション起動処理
- **詳細**:
  - ✅ `activate` 関数を async に変更
  - ✅ ExtensionContainerの初期化
  - ✅ ワークスペースフォルダのスキャンとインデックス構築
  - ✅ コマンド登録の維持
  - ✅ `initializeTaskIndex` 関数の実装
  - ✅ エラーハンドリングとログ出力
- **ファイル**: `src/extension.ts` (73行)

#### ✅ 3. BoardViewProviderとUseCaseの統合
- **内容**: 実際のタスクデータをWebviewに送信
- **詳細**:
  - ✅ BoardViewProviderにExtensionContainerを注入
  - ✅ `_handleBoardLoad` で実際のタスク取得
  - ✅ タスクのstatusでグループ化
  - ✅ TaskエンティティからWebview用CardDataへの変換
  - ✅ エラーハンドリング
- **ファイル**: `src/interface/webview/board-view-provider.ts` (340行)

#### ✅ 4. タスクCRUD操作のWebview統合
- **内容**: Webviewからのタスク操作リクエスト処理
- **詳細**:
  - ✅ `_handleTaskCreate` の実装 (CreateTaskUseCase呼び出し)
  - ✅ `_handleTaskUpdate` の実装 (UpdateTaskUseCase呼び出し)
  - ✅ `_handleTaskDelete` の実装 (DeleteTaskUseCase呼び出し)
  - ✅ `_handleTaskOpen` の実装 (ファイルオープンと行ジャンプ)
  - ✅ 成功時のボード自動再読み込み
  - ✅ エラー通知機能

**参照**: [iteration4-completion-report.md](./iteration4-completion-report.md)

---

## 未実装タスク (優先順位順)

### **Iteration 5: UI/UX改善** ✅ (完了: 2025-10-09)

#### ✅ 1. ドラッグ&ドロップ機能
- **内容**: ボードビューでのタスクカードのドラッグ&ドロップ
- **詳細**:
  - ✅ @dnd-kit ライブラリの導入
  - ✅ SortableTaskCard コンポーネント
  - ✅ DroppableBoardColumn コンポーネント
  - ✅ カード移動時のstatus自動更新
  - ✅ ドラッグ中の視覚的フィードバック
- **ファイル**: 
  - `webview/src/components/SortableTaskCard.tsx` (25行)
  - `webview/src/components/DroppableBoardColumn.tsx` (84行)

#### ✅ 2. タスクカードコンポーネント
- **内容**: 改善されたタスクカード表示
- **詳細**:
  - ✅ リッチな情報表示 (タイトル、期日、担当者、プロジェクト、タグ)
  - ✅ ファイル情報の表示
  - ✅ VS Codeテーマ対応
  - ✅ ドラッグ状態のスタイリング
- **ファイル**: `webview/src/components/TaskCard.tsx` (143行)

#### ✅ 3. タスク編集モーダル
- **内容**: タスクの詳細編集UI
- **詳細**:
  - ✅ モーダルコンポーネントの実装
  - ✅ フォームバリデーション
  - ✅ 全属性の編集 (title, status, assignee, due, project, tags)
  - ✅ 保存/削除/キャンセル機能
- **ファイル**: `webview/src/components/TaskEditModal.tsx` (376行)

#### ✅ 4. タスク作成フォーム
- **内容**: 新規タスク作成UI
- **詳細**:
  - ✅ フォームコンポーネントの実装
  - ✅ 必須項目バリデーション
  - ✅ デフォルト値の設定
  - ✅ Extension連携
- **ファイル**: `webview/src/components/TaskCreateForm.tsx` (400行)

#### ✅ 5. BoardView統合
- **内容**: DndContextとモーダル統合
- **詳細**:
  - ✅ ドラッグ&ドロップイベント処理
  - ✅ タスク編集モーダル統合
  - ✅ タスク作成フォーム統合
  - ✅ 「+ 新規タスク」ボタン追加
  - ✅ Extension通信
- **ファイル**: `webview/src/views/BoardView.tsx` (224行 ← 84行)

**参照**: [iteration5-completion-report.md](./iteration5-completion-report.md)

---

## 未実装タスク (優先順位順)

### **将来イテレーション (M1-M3)**

#### 2. バリデーション診断のDiagnostics実装
  - `src/infrastructure/task-index/task-index-service.factory.ts`

---

### **将来イテレーション (M1-M3)**

#### 2. バリデーション診断のDiagnostics実装
- **内容**: VS Code Diagnostics APIとの連携
- **詳細**:
  - 日付形式/演算子の検査
  - `start <= due`, `est >= 0` 検証
  - 未知ID参照、循環依存検出
  - QuickFixで自動修正提案
- **参照資料**:
  - [仕様書ver1.md](./仕様書ver1.md) - 12. バリデーション & 診断
  - [コンポーネント設計_バリデーション診断.md](./コンポーネント設計_バリデーション診断.md)

#### 3. エディタ内機能（CodeLens/Hover/補完）の実装
- **内容**: Markdown Language Features統合
- **詳細**:
  - CodeLensProvider (依存数/期日/見積の要約)
  - HoverProvider (完全属性、相互参照)
  - CompletionItemProvider (`@due(`, `project:` 補完)
  - SemanticTokensProvider (シンタックスハイライト)
- **参照資料**:
  - [仕様書ver1.md](./仕様書ver1.md) - 6. エディタ内機能

---

## 追加機能 (MVP外)

- **ガントチャート** (M1)
  - 参照: [画面設計_ガントビュー.md](./画面設計_ガントビュー.md)
- **タイムライン** (M1)
  - 参照: [画面設計_タイムラインビュー.md](./画面設計_タイムラインビュー.md)
- **カレンダービュー** (M2)
  - 参照: [画面設計_カレンダービュー.md](./画面設計_カレンダービュー.md)
- **クエリビュー** (M1)
  - 参照: [画面設計_クエリビュー.md](./画面設計_クエリビュー.md)
- **繰り返しタスク (RRULE)** (M2)
- **ICSエクスポート** (M2)
- **クリティカルパス** (M3)

---

## 次のアクション

1. ✅ ~~**タスクCRUD UseCase** の実装~~ (Iteration 2 完了)
2. ✅ ~~**PatchServicePort** の設計と実装~~ (Iteration 2 完了)
3. ✅ ~~**Webview基盤** の構築~~ (Iteration 3 完了)
4. ✅ ~~**Extension統合**~~ (Iteration 4 完了)
5. ✅ ~~**ドラッグ&ドロップ機能** の実装~~ (Iteration 5 完了)
6. ✅ ~~**タスク編集モーダル** の実装~~ (Iteration 5 完了)
7. ✅ ~~**ファイルウォッチャー** によるリアルタイム更新~~ (Iteration 6 完了)

### 🎊 MVP完成！次は将来拡張
- **バリデーション診断** (M1)
- **エディタ内機能** (CodeLens/Hover/補完) (M1)
- **追加ビュー** (ガント、タイムライン、クエリ) (M1-M2)


---

## 📊 実装状況サマリー

### 完了済み (6/6 MVP Iterations) 🎉
- ✅ **Iteration 1**: タスクインデックス構築 (100%)
- ✅ **Iteration 2**: タスクCRUDとパッチ機能 (100%)
- ✅ **Iteration 3**: ボードビュー基盤 (100%)
- ✅ **Iteration 4**: Extension統合 (100%)
- ✅ **Iteration 5**: UI/UX改善 (100%)
  - 詳細レポート: [iteration5-completion-report.md](./iteration5-completion-report.md)
- ✅ **Iteration 6**: リアルタイム更新 (100%)
  - 詳細レポート: [iteration6-completion-report.md](./iteration6-completion-report.md)

### 🎊 **MVP完成！** 
**全コア機能が実装完了しました**

### 品質指標
- **テストカバレッジ**: 69/69 (100%) ← 62から+7
- **TypeScript型エラー**: 0件
- **Lintエラー**: 0件 (9件のa11y警告は非ブロッキング)
- **実装ファイル数**: 87+ファイル ← 85から+2
- **Webviewビルドサイズ**: 261KB (gzip: 80KB)

---

**進捗トラッキング**: 各タスク完了時にこのファイルを更新し、✅マークを追加してください。
